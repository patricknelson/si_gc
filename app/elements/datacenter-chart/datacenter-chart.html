<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/core-ajax/core-ajax.html">
<polymer-element name="datacenter-chart"  attributes="num,height,url">
  <template>

  	<style>
	 :host {
        display: block;
        /*position: relative;
        top: -25px;*/
   }
   .chart-title{
     position: relative;
  left: -40px;
  font-size: 18px;
  z-index: 9;
  margin-bottom: 15px;
}

      .blue{color:#0064D2}
    .green{color:#86B817;}
    .grey{color:#796e65;}
    .lt-blue{color:#66A2E4;}
      .top_label, .bottom_label{position:relative;z-index: 99;}
      .bottom_label{left:-6px; top:-349px;color:#fff;}
      #data_center2{bottom:232px;position:relative;left:-40%;}

      .top_label {
        left: -15px;
        top: 44px;
        font-size:14px;
      }
      .top_label > p{position: relative;left:15px;top:5px;}
      .top_label > p > span {
        font-size: 12px;
        position: absolute;
        color: #796e65;
        left: 2px;
        top: 18px;
        font-weight:bold;
      }
      .top_label > p > span:last-child {font-weight:normal;font-size:10px;top:32px;left: 4.5px;}
      .top_label > p.green{left:5px;}
      .top_label > p.green{left: 36.4%; top: 10px;}  
      .top_label > p.lt-blue{left: 69.6%;top: -172px;}
      .bottom_label > p{position:absolute;top: 55px;font-size: 18px;}
      .bottom_label > p:first-child {left: 4%;}
      .bottom_label > p:nth-child(2) {left: 36.6%;}   
      .bottom_label > p:nth-child(3) {left: 69.5%;} 
      /*.top_label >p{color:red!important;}*/
      @media screen and (min-width:1025px) and (max-width:1349px){
        .top_label {left:0;}
        .bottom_label{left:12px;}
        .top_label > p.green{left: 40.8%; }
        .top_label > p.lt-blue{left: 81.6%;}
        .bottom_label > p:nth-child(2) {left: 41.6%;}   
        .bottom_label > p:nth-child(3) {left: 81.5%;}
      }

      @media screen and (max-width:1024px){ 
        #data_center2{left: -68%;}
        .top_label {left: -49px;}
        .bottom_label{left:10px;}
        .top_label > p.green{left: 49.8%; }
        .top_label > p.lt-blue{left: 98.6%;}
        .bottom_label > p:first-child {left: -17%;}
        .bottom_label > p:nth-child(2) {left: 33.6%;}   
        .bottom_label > p:nth-child(3) {left: 82.5%;} 
      }  



      @media only screen and (max-device-width: 640px), 
           only screen and (max-device-width: 667px){
            .chart-title {left: -16px;  top: 34px;}
            .notChrome.chart-title {left: -16px;  top: 60px!important;}
            #data_center2 {left: -38%;bottom: 144px;}
            .notChrome #data_center2 {left:-46%;}
        .bottom_label{  top: -318px;}
        .notChrome.bottom_label{top:-300px;left:20px;}

        .top_label {top: 88px;}
        .top_label.notChrome {top: 98px;}

        .top_label > p.blue{left: 15%;top:12px;}
        .top_label.notChrome> p.blue{left:18%; top:20px;}

        .top_label > p.green{top: 8px;}
        .top_label.notChrome> p.green{left:54%; top:16px;}

        .top_label > p.lt-blue{left: 82.6%;top:-148px;}
        .top_label.notChrome> p.lt-blue{left:90%; top:-154px;}

        .top_label > p > span:last-child{font-size:10px;left:4px;}
        .bottom_label > p:first-child {left: -.5%;}   
        .bottom_label > p:nth-child(3){left:32.6%;}
        .bottom_label > p:nth-child(3) {left: 68%;} 
        .notChrome.bottom_label > p:nth-child(3){left:72%;}
      }
      @media screen and (device-aspect-ratio: 40/71) {  
        #data_center2{left: -48%;}
          .top_label > p.blue {left:0;}
        .chart-title{margin-bottom: 25px;top:35px;left:-20px;}
        .top_label {  left: -16px;}
        .top_label > p.green {left: 37.8%;}
        .top_label > p.lt-blue {left: 75.6%;}
        .bottom_label > p:first-child {left: -5%;}
        .bottom_label > p:nth-child(3) {left: 70.5%;}
      }

    </style>
<core-ajax auto url="{{url}}" handleAs="json" response="{{response}}"></core-ajax> 
     <div class="chart-title grey {{cls}}">CO<sub>2</sub>e</div>
    <div class="top_label {{cls}}">
      <p class="blue">{{vals[0]}}
        <br><span>{{oldData[2013][0]}}</span>
        <br><span>{{oldData[2012][0]}}</span></p>
      <p class="green">{{vals[1]}}
        <br><span>{{oldData[2013][1]}}</span>
        <br><span>{{oldData[2012][1]}}</span></p>
      <p class="lt-blue">{{vals[2]}}
        <br><span>{{oldData[2013][2]}}</span>
        <br><span>{{oldData[2012][2]}}</span></p>
    </div>
    <google-chart
    class="{{cls}}"
    type="column"
    id="data_center2"
    options='{{opts}}'
    data='scripts/data/data_center2.json'>
  </google-chart>
  <div class="bottom_label {{cls}}"><p>UT</p><p>NV</p><p>AZ</p></div>
  </template>
  <script>
    (function(){
      Polymer({
          ready: function() {
            this.cls   = (this.isNotChrome()) ? "notChrome" : '';
            var width  = (this.isMobile()) ? 500 : 600;
            var height = (this.isMobile()) ? 280 : 350;
            var font   = (this.isMobile()) ? 16 : 18;
            var gwdth  = (this.isMobile()) ? "70%" : "60";
            this.opts  = {"width": width,"height": height,"bar": {"groupWidth": gwdth},"legend": {"position": "none" },"hAxis": { "textPosition": "none","gridlines": {"color": "#ffffff"},"baselineColor": 'transparent' },"vAxis": { "textPosition": "none","gridlines": {"color": "#ffffff"},"baselineColor": 'transparent'},"backgroundColor": { "fill":"transparent" },"annotations": {"alwaysOutside": true, "textStyle": {"fontSize": font}},"animation":{"duration": 3000,"easing": "in"},"tooltip": {"trigger": "none"} }
            this.oldData = {
              2013:['44,490','23,929','50,158'],
              2012:['39,258','12,944','45,866']
            }
          },
          responseChanged: function(oldValue) {
            this.vals = [this.response[1][1],36075,this.response[3][1]];
            this.formatNumbers(this.vals);
          },  
          isMobile :function(){
            return window.matchMedia('screen and (max-width: 767px)').matches;
          },
          isNotChrome:function(){
            return (!!window.chrome && !!window.chrome.webstore) ? false: true;
          },
          formatNumbers:function(data){
              var self = this;
              data.forEach(function(num,i){
                  self.vals[i] = num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
              });
          },
          redraw :function (chrt){
            chrt.drawChart();
          },
          updateChart:function(chrt,rows){
            chrt.rows = rows;
          },
          findChart:function(id){
            //return document.getElementById(id)
            var id = (typeof id === 'undefined') ? this.id : 'energy_trends' + id;
            return this.$[id];
          }
      });
    })();
  </script>
</polymer-element>